import{b as d,c as l}from"./main-Xsqn2ASm.js";function i(t){const{projectId:e}=l();return`https://firestore.googleapis.com/v1/projects/${e}/databases/(default)/documents/users/${t}/todos`}function r(t,e){return`${i(t)}/${e}`}function s(){const t=d();if(!t)throw new Error("Not authenticated");return{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}function u(t){const e=t.name.split("/").pop()??"",o=t.fields??{};return{id:e,text:o.text?.stringValue??"",priority:o.priority?.stringValue??"routine",completed:o.completed?.booleanValue??!1,timestamp:o.timestamp?.timestampValue?new Date(o.timestamp.timestampValue):null}}async function m(t){const e=await fetch(i(t),{headers:s()});if(!e.ok)throw new Error("Failed to fetch todos");return((await e.json()).documents??[]).map(u).sort((a,n)=>(n.timestamp?.getTime()??0)-(a.timestamp?.getTime()??0))}function p(t,e){let o=!0;const a=async()=>{if(o)try{const c=await m(t);o&&e(c)}catch{o&&e([])}};a();const n=window.setInterval(a,3e3);return()=>{o=!1,window.clearInterval(n)}}async function h(t,e){await fetch(i(t),{method:"POST",headers:s(),body:JSON.stringify({fields:{text:{stringValue:e.text},priority:{stringValue:e.priority},completed:{booleanValue:!1},timestamp:{timestampValue:new Date().toISOString()}}})})}async function g(t,e,o){await fetch(`${r(t,e)}?updateMask.fieldPaths=completed`,{method:"PATCH",headers:s(),body:JSON.stringify({fields:{completed:{booleanValue:o}}})})}async function w(t,e){await fetch(r(t,e),{method:"DELETE",headers:s()})}export{h as c,w as d,p as s,g as t};
