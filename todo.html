<!DOCTYPE html>
<html lang="en" data-theme="morning">
<head>
    <meta charset="UTF-8">
    <title>Medora | Clinical Task Manager</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>

/* ===== MEDORA PROFESSIONAL UI v3 ===== */

:root{
    --primary:#2563eb;
    --secondary:#3b82f6;
    --accent:#10b981;
    --danger:#ef4444;
    --warning:#f59e0b;
    --bg-image:url('https://images.unsplash.com/photo-1576089172869-4f5f6f315620?q=80&w=2000&auto=format&fit=crop');
    --glass:rgba(255,255,255,0.78);
    --glass-border:rgba(255,255,255,0.5);
    --text-main:#1e293b;
    --text-muted:#64748b;
    --shadow:0 20px 50px rgba(0,0,0,0.12);
    --radius:22px;
}

[data-theme="icu"]{
    --primary:#38bdf8;
    --secondary:#818cf8;
    --accent:#34d399;
    --bg-image:url('https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?q=80&w=2053&auto=format&fit=crop');
    --glass:rgba(15,23,42,0.88);
    --glass-border:rgba(51,65,85,0.5);
    --text-main:#f1f5f9;
    --text-muted:#94a3b8;
    --shadow:0 25px 60px rgba(0,0,0,0.5);
}

*{
    box-sizing:border-box;
    transition:.3s ease;
}

body{
    margin:0;
    font-family:'Plus Jakarta Sans',sans-serif;
    background:var(--bg-image) no-repeat center center fixed;
    background-size:cover;
    color:var(--text-main);
    min-height:100vh;
    display:flex;
    flex-direction:column;
}

.overlay{
    position:fixed;
    inset:0;
    backdrop-filter:blur(12px);
    background:linear-gradient(135deg,rgba(255,255,255,.05),rgba(0,0,0,.2));
    z-index:-1;
}

/* ===== HEADER ===== */

header{
    padding:18px 40px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:var(--glass);
    border-bottom:1px solid var(--glass-border);
    backdrop-filter:blur(20px);
    position:sticky;
    top:0;
    z-index:1000;
}

.logo-box{
    display:flex;
    align-items:center;
    gap:14px;
    cursor:pointer;
}

.medora-pulse{
    width:46px;
    height:46px;
    border-radius:14px;
    background:linear-gradient(135deg,var(--primary),var(--secondary));
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 10px 20px rgba(37,99,235,.35);
}

.medora-pulse svg{
    width:26px;
    height:26px;
}

.logo-text h1{
    margin:0;
    font-size:20px;
    font-weight:800;
    letter-spacing:-0.5px;
    background:linear-gradient(to right,var(--primary),var(--secondary));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}

/* ===== MAIN WRAPPER ===== */

.main-wrapper{
    max-width:1200px;
    margin:40px auto;
    width:92%;
    display:grid;
    grid-template-columns:1fr 340px;
    gap:30px;
    flex-grow:1;
}

/* ===== TODO CARD ===== */

.todo-section{
    background:var(--glass);
    border-radius:var(--radius);
    padding:40px;
    border:1px solid var(--glass-border);
    box-shadow:var(--shadow);
    backdrop-filter:blur(15px);
}

.section-header h2{
    font-size:26px;
    font-weight:800;
}

.input-group{
    background:rgba(255,255,255,.25);
    padding:8px;
    border-radius:18px;
    display:flex;
    gap:10px;
    border:1px solid var(--glass-border);
    margin-bottom:25px;
    flex-wrap:wrap;
}

.input-group input{
    flex:1;
    min-width:200px;
    background:transparent;
    border:none;
    padding:14px 18px;
    color:var(--text-main);
    font-size:15px;
    outline:none;
}

.priority-select{
    border-radius:12px;
    padding:10px 14px;
}

#addBtn{
    padding:12px 20px;
    border-radius:12px;
}

/* ===== SIDEBAR ===== */

.sidebar{
    display:flex;
    flex-direction:column;
    gap:25px;
}

/* ===== RESPONSIVE ===== */

@media(max-width:1024px){
    .main-wrapper{
        grid-template-columns:1fr;
    }
    .sidebar{
        order:-1;
    }
}

@media(max-width:768px){
    header{
        padding:15px 20px;
    }
    .main-wrapper{
        width:95%;
        margin:25px auto 120px;
    }
    .todo-section{
        padding:25px;
    }
}

</style>
</head>
<body>

<div class="overlay"></div>

<header>
    <div class="logo-box" onclick="window.location.href='dashboard.html'">
        <div class="medora-pulse">
            <svg viewBox="0 0 24 24" fill="none">
                <path d="M3 13C6 11 9 10 12 10C15 10 18 11 21 13C18 14 15 15 12 15C9 15 6 14 3 13Z" fill="white"/>
                <path d="M12 10L10 6H14L12 10Z" fill="white"/>
            </svg>
        </div>
        <div class="logo-text">
            <h1>MEDORA <span style="font-weight:300;font-size:14px;">| Clinical Hub</span></h1>
        </div>
    </div>

    <div style="display:flex;gap:15px;align-items:center;">
        <button class="theme-switch" onclick="toggleTheme()">
            <i id="theme-icon" class="fas fa-sun"></i>
            <span id="theme-text">Morning Mode</span>
        </button>
        <div id="user-info" style="font-size:14px;font-weight:600;">Authenticating...</div>
    </div>
</header>

<main class="main-wrapper">
        <!-- Tasks Section -->
        <section class="todo-section">
            <div class="section-header">
                <h2>Clinical Rounds & Tasks</h2>
                <p>Prioritize your medical duties and academic requirements.</p>
            </div>

            <div class="input-group">
                <input id="taskInput" type="text" placeholder="Add a new task, lecture or clinical case...">
                <select id="prioritySelect" class="priority-select">
                    <option value="routine">Routine</option>
                    <option value="urgent">Urgent</option>
                    <option value="emergency">Emergency</option>
                </select>
                <button id="addBtn">
                    <i class="fas fa-plus"></i> Add
                </button>
            </div>

            <ul id="list"></ul>
        </section>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="stats-card">
                <h3>Completion Rate</h3>
                <div class="progress-container">
                    <svg width="180" height="180">
                        <circle cx="90" cy="90" r="70" class="circle-bg"/>
                        <circle cx="90" cy="90" r="70" class="circle-fg" id="progressCircle"/>
                    </svg>
                    <div class="percentage" id="progressText">0%</div>
                </div>
                <p id="statsSummary" style="color: var(--text-muted); font-size: 14px;">
                    No tasks yet. Ready for your shift?
                </p>
            </div>

            <div class="stats-card" style="text-align: left;">
                <h4 style="margin-bottom: 10px;">
                    <i class="fas fa-lightbulb" style="color: var(--warning);"></i> Medical Pearl
                </h4>
                <p id="quote" style="font-style: italic; font-size: 13px; line-height: 1.5;">
                    "The good physician treats the disease; the great physician treats the patient who has the disease." — William Osler
                </p>
            </div>
        </aside>
    </main>

    <nav class="bottom-nav">
        <a href="dashboard.html" title="Dashboard"><i class="fas fa-th-large"></i></a>
        <a href="#" class="active" title="To-Do"><i class="fas fa-clipboard-list"></i></a>
        <a href="timer.html" title="Study Timer"><i class="fas fa-stopwatch"></i></a>
        <a href="scores.html" title="Medical Scores"><i class="fas fa-file-medical-alt"></i></a>
    </nav>

    <div id="status-toast"></div>

<script>
/* ===========================
   FIREBASE CONFIGURATION
=========================== */

const firebaseConfig = {
    apiKey: "AIzaSyCRVWEvWa-xOi3NFjP-IdIaCBXNJoEOKqY",
    authDomain: "medora-app-10e70.firebaseapp.com",
    projectId: "medora-app-10e70"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ===========================
   DOM ELEMENTS
=========================== */

const taskInput = document.getElementById("taskInput");
const prioritySelect = document.getElementById("prioritySelect");
const addBtn = document.getElementById("addBtn");
const list = document.getElementById("list");
const progressText = document.getElementById("progressText");
const progressCircle = document.getElementById("progressCircle");
const statsSummary = document.getElementById("statsSummary");
const toast = document.getElementById("status-toast");
const userInfo = document.getElementById("user-info");

let userId = null;

/* ===========================
   AUTH STATE
=========================== */

auth.onAuthStateChanged(user => {
    if (!user) {
        showToast("Redirecting to login...", "#ef4444");
        setTimeout(() => window.location.href = "login.html", 2000);
        return;
    }

    userId = user.uid;
    userInfo.innerHTML = `<i class="fas fa-user-md"></i> ${user.email.split('@')[0]}`;
    showToast("Clinical Data Synced ✔");
    loadTasks();
});

/* ===========================
   THEME TOGGLE
=========================== */

function toggleTheme() {
    const html = document.documentElement;
    const icon = document.getElementById("theme-icon");
    const text = document.getElementById("theme-text");

    if (html.getAttribute("data-theme") === "morning") {
        html.setAttribute("data-theme", "icu");
        icon.className = "fas fa-moon";
        text.innerText = "ICU Night Mode";
    } else {
        html.setAttribute("data-theme", "morning");
        icon.className = "fas fa-sun";
        text.innerText = "Morning Mode";
    }
}

/* ===========================
   ADD TASK
=========================== */

addBtn.onclick = () => {
    const text = taskInput.value.trim();
    const priority = prioritySelect.value;

    if (!text || !userId) {
        taskInput.style.border = "1px solid var(--danger)";
        return;
    }

    db.collection("users").doc(userId).collection("todos").add({
        text: text,
        priority: priority,
        completed: false,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
        taskInput.value = "";
        showToast("Task Added to Rounds");
    }).catch(err => {
        showToast("Sync Error: " + err.message, "#ef4444");
    });
};

/* ===========================
   LOAD TASKS
=========================== */

function loadTasks() {
    db.collection("users")
      .doc(userId)
      .collection("todos")
      .orderBy("timestamp", "desc")
      .onSnapshot(snapshot => {

        list.innerHTML = "";
        let total = snapshot.size;
        let done = 0;

        if (total === 0) {
            list.innerHTML =
                `<li style="justify-content:center;color:var(--text-muted);">
                    No current medical tasks. Take a break!
                 </li>`;
            updateProgress(0, 0);
            return;
        }

        snapshot.forEach(doc => {
            const task = doc.data();
            if (task.completed) done++;

            const li = document.createElement("li");
            li.className =
                `priority-${task.priority} ${task.completed ? 'done' : ''}`;

            const time = task.timestamp
                ? new Date(task.timestamp.toDate())
                    .toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})
                : "Just now";

            li.innerHTML = `
                <div class="task-info">
                    <i class="fas ${task.completed ? 'fa-check-circle' : 'fa-notes-medical'}"
                       style="color:${task.completed ? 'var(--accent)' : 'var(--primary)'};font-size:20px;">
                    </i>
                    <div>
                        <span class="task-text">${task.text}</span>
                        <span class="task-meta">
                            <i class="far fa-clock"></i> ${time} | ${task.priority.toUpperCase()}
                        </span>
                    </div>
                </div>

                <div class="task-actions">
                    <button class="btn-icon btn-done"
                        onclick="toggleTask('${doc.id}', ${task.completed})">
                        <i class="fas fa-check"></i>
                    </button>
                    <button class="btn-icon btn-delete"
                        onclick="deleteTask('${doc.id}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;

            list.appendChild(li);
        });

        updateProgress(done, total);
    });
}

/* ===========================
   TASK ACTIONS
=========================== */

window.toggleTask = (id, currentStatus) => {
    db.collection("users")
      .doc(userId)
      .collection("todos")
      .doc(id)
      .update({ completed: !currentStatus });
};

window.deleteTask = (id) => {
    if (confirm("Confirm dismissal of this task?")) {
        db.collection("users")
          .doc(userId)
          .collection("todos")
          .doc(id)
          .delete();
        showToast("Task Dismissed", "#64748b");
    }
};

/* ===========================
   PROGRESS UI
=========================== */

function updateProgress(done, total) {
    const percent = total === 0 ? 0 :
        Math.round((done / total) * 100);

    progressText.innerText = percent + "%";

    const offset = 440 - (440 * percent) / 100;
    progressCircle.style.strokeDashoffset = offset;

    if (percent < 30)
        progressCircle.style.stroke = "var(--danger)";
    else if (percent < 80)
        progressCircle.style.stroke = "var(--warning)";
    else
        progressCircle.style.stroke = "var(--accent)";

    statsSummary.innerText =
        `${done} of ${total} clinical objectives met.`;
}

/* ===========================
   TOAST
=========================== */

function showToast(msg, color = "#2563eb") {
    toast.innerText = msg;
    toast.style.background = color;
    toast.style.display = "block";
    setTimeout(() => {
        toast.style.display = "none";
    }, 3000);
}

/* ===========================
   ENTER KEY
=========================== */

taskInput.addEventListener("keypress", e => {
    if (e.key === "Enter") addBtn.click();
});

</script>
</body>
</html>
