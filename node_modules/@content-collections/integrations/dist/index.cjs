//#region rolldown:runtime
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __copyProps = (to, from, except, desc) => {
	if (from && typeof from === "object" || typeof from === "function") for (var keys = __getOwnPropNames(from), i = 0, n = keys.length, key; i < n; i++) {
		key = keys[i];
		if (!__hasOwnProp.call(to, key) && key !== except) __defProp(to, key, {
			get: ((k) => from[k]).bind(null, key),
			enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable
		});
	}
	return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", {
	value: mod,
	enumerable: true
}) : target, mod));

//#endregion
let node_path = require("node:path");
node_path = __toESM(node_path);

//#region src/errors.ts
const handledErrors = ["transformer:validation-error", "collector:parse-error"];
function isUnknownError(event) {
	return !handledErrors.includes(event);
}
function registerErrorListeners(builder) {
	builder.on("transformer:validation-error", (event) => {
		console.log();
		console.log("Validation failed on", node_path.default.join(event.collection.directory, event.file.path) + ":");
		console.log(event.error.message);
		console.log();
	});
	builder.on("collector:parse-error", (event) => {
		console.log();
		console.log("Failed to parse file", node_path.default.join(event.filePath) + ":");
		console.log(event.error.message);
		console.log();
	});
}

//#endregion
//#region src/index.ts
const defaultOptions = { handleError: () => {
	if (process.env.NODE_ENV === "production") process.exit(1);
} };
function configureLogging(builder, options = defaultOptions) {
	builder.on("builder:start", () => {
		console.log("build started ...");
	});
	builder.on("builder:end", (event) => {
		console.log("... finished build of", event.stats.collections, event.stats.collections === 1 ? "collection" : "collections", "and", event.stats.documents, event.stats.documents === 1 ? "document" : "documents", "in", event.endedAt - event.startedAt + "ms");
	});
	builder.on("watcher:config-changed", () => console.log("... config changed"));
	builder.on("watcher:file-changed", (event) => {
		const relativePath = node_path.default.relative(process.cwd(), event.filePath);
		if (event.modification === "delete") console.log("... file", relativePath, "deleted");
		else console.log("... file", relativePath, "changed");
	});
	builder.on("transformer:document-skipped", (event) => {
		const relativePath = node_path.default.relative(process.cwd(), event.filePath);
		console.log("... document", relativePath, "skipped", "due to", event.reason);
	});
	registerErrorListeners(builder);
	builder.on("_error", ({ _event, error }) => {
		if (isUnknownError(_event)) console.log("... error", error.message);
		options.handleError?.(error);
	});
}

//#endregion
exports.configureLogging = configureLogging;