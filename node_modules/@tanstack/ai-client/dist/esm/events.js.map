{"version":3,"file":"events.js","sources":["../../src/events.ts"],"sourcesContent":["import { aiEventClient } from '@tanstack/ai/event-client'\nimport type { ContentPart } from '@tanstack/ai'\nimport type { UIMessage } from './types'\n\n/**\n * Abstract base class for ChatClient event emission\n */\nexport abstract class ChatClientEventEmitter {\n  protected clientId: string\n\n  constructor(clientId: string) {\n    this.clientId = clientId\n  }\n\n  /**\n   * Protected abstract method for emitting events\n   * Implementations should handle adding clientId and timestamp\n   */\n  protected abstract emitEvent(\n    eventName: string,\n    data?: Record<string, unknown>,\n  ): void\n\n  /**\n   * Emit client created event\n   */\n  clientCreated(initialMessageCount: number): void {\n    this.emitEvent('client:created', {\n      initialMessageCount,\n    })\n  }\n\n  /**\n   * Emit loading state changed event\n   */\n  loadingChanged(isLoading: boolean): void {\n    this.emitEvent('client:loading:changed', { isLoading })\n  }\n\n  /**\n   * Emit error state changed event\n   */\n  errorChanged(error: string | null): void {\n    this.emitEvent('client:error:changed', {\n      error,\n    })\n  }\n\n  /**\n   * Emit text update events (combines processor and client events)\n   */\n  textUpdated(streamId: string, messageId: string, content: string): void {\n    this.emitEvent('text:chunk:content', {\n      streamId,\n      messageId,\n      content,\n    })\n  }\n\n  /**\n   * Emit tool call state change events (combines processor and client events)\n   */\n  toolCallStateChanged(\n    streamId: string,\n    messageId: string,\n    toolCallId: string,\n    toolName: string,\n    state: string,\n    args: string,\n  ): void {\n    this.emitEvent('tools:call:updated', {\n      streamId,\n      messageId,\n      toolCallId,\n      toolName,\n      state,\n      arguments: args,\n    })\n  }\n\n  /**\n   * Emit tool result state change event\n   */\n  /**\n   * Emit thinking update event\n   */\n  thinkingUpdated(\n    streamId: string,\n    messageId: string,\n    content: string,\n    delta?: string,\n  ): void {\n    this.emitEvent('text:chunk:thinking', {\n      streamId,\n      messageId,\n      content,\n      delta,\n    })\n  }\n\n  /**\n   * Emit approval requested event\n   */\n  approvalRequested(\n    streamId: string,\n    messageId: string,\n    toolCallId: string,\n    toolName: string,\n    input: unknown,\n    approvalId: string,\n  ): void {\n    this.emitEvent('tools:approval:requested', {\n      streamId,\n      messageId,\n      toolCallId,\n      toolName,\n      input,\n      approvalId,\n    })\n  }\n\n  /**\n   * Emit message appended event\n   */\n  messageAppended(uiMessage: UIMessage, streamId?: string): void {\n    const content = uiMessage.parts\n      .filter((part) => part.type === 'text')\n      .map((part) => part.content)\n      .join(' ')\n\n    this.emitEvent('text:message:created', {\n      streamId,\n      messageId: uiMessage.id,\n      role: uiMessage.role,\n      content,\n      parts: uiMessage.parts,\n    })\n  }\n\n  /**\n   * Emit message sent event.\n   * Supports both simple string content and multimodal content arrays.\n   *\n   * @param messageId - The ID of the sent message\n   * @param content - The message content (string or array of ContentPart for multimodal)\n   */\n  messageSent(messageId: string, content: string | Array<ContentPart>): void {\n    // For text content, extract it; for multimodal, provide the array\n    const textContent =\n      typeof content === 'string'\n        ? content\n        : content\n            .filter((part) => part.type === 'text')\n            .map((part) => (part as { type: 'text'; content: string }).content)\n            .join('')\n\n    this.emitEvent('text:message:created', {\n      messageId,\n      role: 'user',\n      content: textContent,\n      // Include full content for multimodal messages\n      ...(Array.isArray(content) && { parts: content }),\n    })\n\n    this.emitEvent('text:message:user', {\n      messageId,\n      role: 'user',\n      content: textContent,\n      // Include full content for multimodal messages\n      ...(Array.isArray(content) && { parts: content }),\n    })\n  }\n\n  /**\n   * Emit reloaded event\n   */\n  reloaded(fromMessageIndex: number): void {\n    this.emitEvent('client:reloaded', {\n      fromMessageIndex,\n    })\n  }\n  /**\n   * Emit stopped event\n   */\n  stopped(): void {\n    this.emitEvent('client:stopped')\n  }\n\n  /**\n   * Emit messages cleared event\n   */\n  messagesCleared(): void {\n    this.emitEvent('client:messages:cleared')\n  }\n\n  /**\n   * Emit tool result added event\n   */\n  toolResultAdded(\n    toolCallId: string,\n    toolName: string,\n    output: unknown,\n    state: string,\n  ): void {\n    this.emitEvent('tools:result:added', {\n      toolCallId,\n      toolName,\n      output,\n      state,\n    })\n  }\n\n  /**\n   * Emit tool approval responded event\n   */\n  toolApprovalResponded(\n    approvalId: string,\n    toolCallId: string,\n    approved: boolean,\n  ): void {\n    this.emitEvent('tools:approval:responded', {\n      approvalId,\n      toolCallId,\n      approved,\n    })\n  }\n}\n\n/**\n * Default implementation of ChatClientEventEmitter\n */\nexport class DefaultChatClientEventEmitter extends ChatClientEventEmitter {\n  /**\n   * Emit an event with automatic clientId and timestamp for client/tool events\n   */\n  protected emitEvent(eventName: string, data?: Record<string, any>): void {\n    // For client:* and tool:* events, automatically add clientId and timestamp\n    if (\n      eventName.startsWith('client:') ||\n      eventName.startsWith('tools:') ||\n      eventName.startsWith('text:')\n    ) {\n      aiEventClient.emit(eventName as any, {\n        ...data,\n        clientId: this.clientId,\n        source: 'client',\n        timestamp: Date.now(),\n      })\n    } else {\n      // For other events, just add timestamp\n      aiEventClient.emit(eventName as any, {\n        ...data,\n        timestamp: Date.now(),\n      })\n    }\n  }\n}\n"],"names":[],"mappings":"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"}