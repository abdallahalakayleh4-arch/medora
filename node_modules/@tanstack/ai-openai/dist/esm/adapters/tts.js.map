{"version":3,"file":"tts.js","sources":["../../../src/adapters/tts.ts"],"sourcesContent":["import { BaseTTSAdapter } from '@tanstack/ai/adapters'\nimport {\n  createOpenAIClient,\n  generateId,\n  getOpenAIApiKeyFromEnv,\n} from '../utils/client'\nimport {\n  validateAudioInput,\n  validateInstructions,\n  validateSpeed,\n} from '../audio/audio-provider-options'\nimport type { OpenAITTSModel } from '../model-meta'\nimport type {\n  OpenAITTSFormat,\n  OpenAITTSProviderOptions,\n  OpenAITTSVoice,\n} from '../audio/tts-provider-options'\nimport type { TTSOptions, TTSResult } from '@tanstack/ai'\nimport type OpenAI_SDK from 'openai'\nimport type { OpenAIClientConfig } from '../utils/client'\n\n/**\n * Configuration for OpenAI TTS adapter\n */\nexport interface OpenAITTSConfig extends OpenAIClientConfig {}\n\n/**\n * OpenAI Text-to-Speech Adapter\n *\n * Tree-shakeable adapter for OpenAI TTS functionality.\n * Supports tts-1, tts-1-hd, and gpt-4o-audio-preview models.\n *\n * Features:\n * - Multiple voice options: alloy, ash, ballad, coral, echo, fable, onyx, nova, sage, shimmer, verse\n * - Multiple output formats: mp3, opus, aac, flac, wav, pcm\n * - Speed control (0.25 to 4.0)\n */\nexport class OpenAITTSAdapter<\n  TModel extends OpenAITTSModel,\n> extends BaseTTSAdapter<TModel, OpenAITTSProviderOptions> {\n  readonly name = 'openai' as const\n\n  private client: OpenAI_SDK\n\n  constructor(config: OpenAITTSConfig, model: TModel) {\n    super(config, model)\n    this.client = createOpenAIClient(config)\n  }\n\n  async generateSpeech(\n    options: TTSOptions<OpenAITTSProviderOptions>,\n  ): Promise<TTSResult> {\n    const { model, text, voice, format, speed, modelOptions } = options\n\n    // Validate inputs using existing validators\n    const audioOptions = {\n      input: text,\n      model,\n      voice: voice as OpenAITTSVoice,\n      speed,\n      response_format: format as OpenAITTSFormat,\n      ...modelOptions,\n    }\n\n    validateAudioInput(audioOptions)\n    validateSpeed(audioOptions)\n    validateInstructions(audioOptions)\n\n    // Build request\n    const request: OpenAI_SDK.Audio.SpeechCreateParams = {\n      model,\n      input: text,\n      voice: voice || 'alloy',\n      response_format: format,\n      speed,\n      ...modelOptions,\n    }\n\n    // Call OpenAI API\n    const response = await this.client.audio.speech.create(request)\n\n    // Convert response to base64\n    const arrayBuffer = await response.arrayBuffer()\n    const base64 = Buffer.from(arrayBuffer).toString('base64')\n\n    const outputFormat = format || 'mp3'\n    const contentType = this.getContentType(outputFormat)\n\n    return {\n      id: generateId(this.name),\n      model,\n      audio: base64,\n      format: outputFormat,\n      contentType,\n    }\n  }\n\n  private getContentType(format: string): string {\n    const contentTypes: Record<string, string> = {\n      mp3: 'audio/mpeg',\n      opus: 'audio/opus',\n      aac: 'audio/aac',\n      flac: 'audio/flac',\n      wav: 'audio/wav',\n      pcm: 'audio/pcm',\n    }\n    return contentTypes[format] || 'audio/mpeg'\n  }\n}\n\n/**\n * Creates an OpenAI speech adapter with explicit API key.\n * Type resolution happens here at the call site.\n *\n * @param model - The model name (e.g., 'tts-1', 'tts-1-hd')\n * @param apiKey - Your OpenAI API key\n * @param config - Optional additional configuration\n * @returns Configured OpenAI speech adapter instance with resolved types\n *\n * @example\n * ```typescript\n * const adapter = createOpenaiSpeech('tts-1-hd', \"sk-...\");\n *\n * const result = await generateSpeech({\n *   adapter,\n *   text: 'Hello, world!',\n *   voice: 'nova'\n * });\n * ```\n */\nexport function createOpenaiSpeech<TModel extends OpenAITTSModel>(\n  model: TModel,\n  apiKey: string,\n  config?: Omit<OpenAITTSConfig, 'apiKey'>,\n): OpenAITTSAdapter<TModel> {\n  return new OpenAITTSAdapter({ apiKey, ...config }, model)\n}\n\n/**\n * Creates an OpenAI speech adapter with automatic API key detection from environment variables.\n * Type resolution happens here at the call site.\n *\n * Looks for `OPENAI_API_KEY` in:\n * - `process.env` (Node.js)\n * - `window.env` (Browser with injected env)\n *\n * @param model - The model name (e.g., 'tts-1', 'tts-1-hd')\n * @param config - Optional configuration (excluding apiKey which is auto-detected)\n * @returns Configured OpenAI speech adapter instance with resolved types\n * @throws Error if OPENAI_API_KEY is not found in environment\n *\n * @example\n * ```typescript\n * // Automatically uses OPENAI_API_KEY from environment\n * const adapter = openaiSpeech('tts-1');\n *\n * const result = await generateSpeech({\n *   adapter,\n *   text: 'Welcome to TanStack AI!',\n *   voice: 'alloy',\n *   format: 'mp3'\n * });\n * ```\n */\nexport function openaiSpeech<TModel extends OpenAITTSModel>(\n  model: TModel,\n  config?: Omit<OpenAITTSConfig, 'apiKey'>,\n): OpenAITTSAdapter<TModel> {\n  const apiKey = getOpenAIApiKeyFromEnv()\n  return createOpenaiSpeech(model, apiKey, config)\n}\n"],"names":[],"mappings":";;;AAqCO,MAAM,yBAEH,eAAiD;AAAA,EAKzD,YAAY,QAAyB,OAAe;AAClD,UAAM,QAAQ,KAAK;AALrB,SAAS,OAAO;AAMd,SAAK,SAAS,mBAAmB,MAAM;AAAA,EACzC;AAAA,EAEA,MAAM,eACJ,SACoB;AACpB,UAAM,EAAE,OAAO,MAAM,OAAO,QAAQ,OAAO,iBAAiB;AAG5D,UAAM,eAAe;AAAA,MACnB,OAAO;AAAA,MACP;AAAA,MAEA;AAAA,MAEA,GAAG;AAAA,IAAA;AAGL,uBAAmB,YAAY;AAC/B,kBAAc,YAAY;AAC1B,yBAAqB,YAAY;AAGjC,UAAM,UAA+C;AAAA,MACnD;AAAA,MACA,OAAO;AAAA,MACP,OAAO,SAAS;AAAA,MAChB,iBAAiB;AAAA,MACjB;AAAA,MACA,GAAG;AAAA,IAAA;AAIL,UAAM,WAAW,MAAM,KAAK,OAAO,MAAM,OAAO,OAAO,OAAO;AAG9D,UAAM,cAAc,MAAM,SAAS,YAAA;AACnC,UAAM,SAAS,OAAO,KAAK,WAAW,EAAE,SAAS,QAAQ;AAEzD,UAAM,eAAe,UAAU;AAC/B,UAAM,cAAc,KAAK,eAAe,YAAY;AAEpD,WAAO;AAAA,MACL,IAAI,WAAW,KAAK,IAAI;AAAA,MACxB;AAAA,MACA,OAAO;AAAA,MACP,QAAQ;AAAA,MACR;AAAA,IAAA;AAAA,EAEJ;AAAA,EAEQ,eAAe,QAAwB;AAC7C,UAAM,eAAuC;AAAA,MAC3C,KAAK;AAAA,MACL,MAAM;AAAA,MACN,KAAK;AAAA,MACL,MAAM;AAAA,MACN,KAAK;AAAA,MACL,KAAK;AAAA,IAAA;AAEP,WAAO,aAAa,MAAM,KAAK;AAAA,EACjC;AACF;AAsBO,SAAS,mBACd,OACA,QACA,QAC0B;AAC1B,SAAO,IAAI,iBAAiB,EAAE,QAAQ,GAAG,OAAA,GAAU,KAAK;AAC1D;AA4BO,SAAS,aACd,OACA,QAC0B;AAC1B,QAAM,SAAS,uBAAA;AACf,SAAO,mBAAmB,OAAO,QAAQ,MAAM;AACjD;"}