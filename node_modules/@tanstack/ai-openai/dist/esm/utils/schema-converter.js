function transformNullsToUndefined(obj) {
  if (obj === null) {
    return void 0;
  }
  if (Array.isArray(obj)) {
    return obj.map((item) => transformNullsToUndefined(item));
  }
  if (typeof obj === "object") {
    const result = {};
    for (const [key, value] of Object.entries(obj)) {
      const transformed = transformNullsToUndefined(value);
      if (transformed !== void 0) {
        result[key] = transformed;
      }
    }
    return result;
  }
  return obj;
}
function makeOpenAIStructuredOutputCompatible(schema, originalRequired = []) {
  const result = { ...schema };
  if (result.type === "object" && result.properties) {
    const properties = { ...result.properties };
    const allPropertyNames = Object.keys(properties);
    for (const propName of allPropertyNames) {
      const prop = properties[propName];
      const wasOptional = !originalRequired.includes(propName);
      if (prop.type === "object" && prop.properties) {
        properties[propName] = makeOpenAIStructuredOutputCompatible(
          prop,
          prop.required || []
        );
      } else if (prop.type === "array" && prop.items) {
        properties[propName] = {
          ...prop,
          items: makeOpenAIStructuredOutputCompatible(
            prop.items,
            prop.items.required || []
          )
        };
      } else if (prop.anyOf) {
        properties[propName] = makeOpenAIStructuredOutputCompatible(
          prop,
          prop.required || []
        );
      } else if (prop.oneOf) {
        throw new Error(
          "oneOf is not supported in OpenAI structured output schemas. Check the supported outputs here: https://platform.openai.com/docs/guides/structured-outputs#supported-types"
        );
      } else if (wasOptional) {
        if (prop.type && !Array.isArray(prop.type)) {
          properties[propName] = {
            ...prop,
            type: [prop.type, "null"]
          };
        } else if (Array.isArray(prop.type) && !prop.type.includes("null")) {
          properties[propName] = {
            ...prop,
            type: [...prop.type, "null"]
          };
        }
      }
    }
    result.properties = properties;
    result.required = allPropertyNames;
    result.additionalProperties = false;
  }
  if (result.type === "array" && result.items) {
    result.items = makeOpenAIStructuredOutputCompatible(
      result.items,
      result.items.required || []
    );
  }
  if (result.anyOf && Array.isArray(result.anyOf)) {
    result.anyOf = result.anyOf.map(
      (variant) => makeOpenAIStructuredOutputCompatible(variant, variant.required || [])
    );
  }
  if (result.oneOf) {
    throw new Error(
      "oneOf is not supported in OpenAI structured output schemas. Check the supported outputs here: https://platform.openai.com/docs/guides/structured-outputs#supported-types"
    );
  }
  return result;
}
export {
  makeOpenAIStructuredOutputCompatible,
  transformNullsToUndefined
};
//# sourceMappingURL=schema-converter.js.map
