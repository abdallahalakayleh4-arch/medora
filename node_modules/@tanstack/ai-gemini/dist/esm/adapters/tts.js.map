{"version":3,"file":"tts.js","sources":["../../../src/adapters/tts.ts"],"sourcesContent":["import { BaseTTSAdapter } from '@tanstack/ai/adapters'\nimport {\n  createGeminiClient,\n  generateId,\n  getGeminiApiKeyFromEnv,\n} from '../utils'\nimport type { GEMINI_TTS_MODELS, GeminiTTSVoice } from '../model-meta'\nimport type { TTSOptions, TTSResult } from '@tanstack/ai'\nimport type { GoogleGenAI } from '@google/genai'\nimport type { GeminiClientConfig } from '../utils'\n\n/**\n * Provider-specific options for Gemini TTS\n *\n * @experimental Gemini TTS is an experimental feature.\n * @see https://ai.google.dev/gemini-api/docs/speech-generation\n */\nexport interface GeminiTTSProviderOptions {\n  /**\n   * Voice configuration for TTS.\n   * Choose from 30 available voices with different characteristics.\n   */\n  voiceConfig?: {\n    prebuiltVoiceConfig?: {\n      /**\n       * The voice name to use for speech synthesis.\n       * @see https://ai.google.dev/gemini-api/docs/speech-generation#voices\n       */\n      voiceName?: GeminiTTSVoice\n    }\n  }\n\n  /**\n   * System instruction for controlling speech style.\n   * Use natural language to describe the desired speaking style,\n   * pace, tone, accent, or other characteristics.\n   *\n   * @example \"Speak slowly and calmly, as if telling a bedtime story\"\n   * @example \"Use an upbeat, enthusiastic tone with moderate pace\"\n   * @example \"Speak with a British accent\"\n   */\n  systemInstruction?: string\n\n  /**\n   * Language code hint for the speech synthesis.\n   * Gemini TTS supports 24 languages and can auto-detect,\n   * but you can provide a hint for better results.\n   *\n   * @example \"en-US\" for American English\n   * @example \"es-ES\" for Spanish (Spain)\n   * @example \"ja-JP\" for Japanese\n   */\n  languageCode?: string\n}\n\n/**\n * Configuration for Gemini TTS adapter\n *\n * @experimental Gemini TTS is an experimental feature.\n */\nexport interface GeminiTTSConfig extends GeminiClientConfig {}\n\n/** Model type for Gemini TTS */\nexport type GeminiTTSModel = (typeof GEMINI_TTS_MODELS)[number]\n\n/**\n * Gemini Text-to-Speech Adapter\n *\n * Tree-shakeable adapter for Gemini TTS functionality.\n *\n * **IMPORTANT**: Gemini TTS uses the Live API (WebSocket-based) which requires\n * different handling than traditional REST APIs. This adapter provides a\n * simplified interface but may have limitations.\n *\n * @experimental Gemini TTS is an experimental feature and may change.\n *\n * Models:\n * - gemini-2.5-flash-preview-tts\n */\nexport class GeminiTTSAdapter<\n  TModel extends GeminiTTSModel,\n> extends BaseTTSAdapter<TModel, GeminiTTSProviderOptions> {\n  readonly name = 'gemini' as const\n\n  private client: GoogleGenAI\n\n  constructor(config: GeminiTTSConfig, model: TModel) {\n    super(config, model)\n    this.client = createGeminiClient(config)\n  }\n\n  /**\n   * Generate speech from text using Gemini's TTS model.\n   *\n   * @experimental This implementation is experimental and may change.\n   * @see https://ai.google.dev/gemini-api/docs/speech-generation\n   */\n  async generateSpeech(\n    options: TTSOptions<GeminiTTSProviderOptions>,\n  ): Promise<TTSResult> {\n    const { model, text, modelOptions } = options\n\n    const voiceConfig = modelOptions?.voiceConfig || {\n      prebuiltVoiceConfig: {\n        voiceName: 'Kore',\n      },\n    }\n\n    const response = await this.client.models.generateContent({\n      model,\n      contents: [\n        {\n          role: 'user',\n          parts: [{ text }],\n        },\n      ],\n      config: {\n        responseModalities: ['AUDIO'],\n        speechConfig: {\n          voiceConfig,\n          ...(modelOptions?.languageCode && {\n            languageCode: modelOptions.languageCode,\n          }),\n        },\n      },\n      ...(modelOptions?.systemInstruction && {\n        systemInstruction: modelOptions.systemInstruction,\n      }),\n    })\n\n    // Extract audio data from response\n    const candidate = response.candidates?.[0]\n    const parts = candidate?.content?.parts\n\n    if (!parts || parts.length === 0) {\n      throw new Error('No audio output received from Gemini TTS')\n    }\n\n    // Look for inline data (audio)\n    const audioPart = parts.find((part: any) =>\n      part.inlineData?.mimeType?.startsWith('audio/'),\n    )\n\n    if (!audioPart || !audioPart.inlineData || !audioPart.inlineData.data) {\n      throw new Error('No audio data in Gemini TTS response')\n    }\n\n    const audioBase64 = audioPart.inlineData.data\n    const mimeType = audioPart.inlineData.mimeType || 'audio/wav'\n    const format = mimeType.split('/')[1] || 'wav'\n\n    return {\n      id: generateId(this.name),\n      model,\n      audio: audioBase64,\n      format,\n      contentType: mimeType,\n    }\n  }\n}\n\n/**\n * Creates a Gemini TTS adapter with explicit API key.\n * Type resolution happens here at the call site.\n *\n * @experimental Gemini TTS is an experimental feature and may change.\n *\n * @param model - The model name (e.g., 'gemini-2.5-flash-preview-tts')\n * @param apiKey - Your Google API key\n * @param config - Optional additional configuration\n * @returns Configured Gemini TTS adapter instance with resolved types\n *\n * @example\n * ```typescript\n * const adapter = createGeminiSpeech('gemini-2.5-flash-preview-tts', \"your-api-key\");\n *\n * const result = await generateSpeech({\n *   adapter,\n *   text: 'Hello, world!'\n * });\n * ```\n */\nexport function createGeminiSpeech<TModel extends GeminiTTSModel>(\n  model: TModel,\n  apiKey: string,\n  config?: Omit<GeminiTTSConfig, 'apiKey'>,\n): GeminiTTSAdapter<TModel> {\n  return new GeminiTTSAdapter({ apiKey, ...config }, model)\n}\n\n/**\n * Creates a Gemini speech adapter with automatic API key detection from environment variables.\n * Type resolution happens here at the call site.\n *\n * @experimental Gemini TTS is an experimental feature and may change.\n *\n * Looks for `GOOGLE_API_KEY` or `GEMINI_API_KEY` in:\n * - `process.env` (Node.js)\n * - `window.env` (Browser with injected env)\n *\n * @param model - The model name (e.g., 'gemini-2.5-flash-preview-tts')\n * @param config - Optional configuration (excluding apiKey which is auto-detected)\n * @returns Configured Gemini speech adapter instance with resolved types\n * @throws Error if GOOGLE_API_KEY or GEMINI_API_KEY is not found in environment\n *\n * @example\n * ```typescript\n * // Automatically uses GOOGLE_API_KEY from environment\n * const adapter = geminiSpeech('gemini-2.5-flash-preview-tts');\n *\n * const result = await generateSpeech({\n *   adapter,\n *   text: 'Welcome to TanStack AI!'\n * });\n * ```\n */\nexport function geminiSpeech<TModel extends GeminiTTSModel>(\n  model: TModel,\n  config?: Omit<GeminiTTSConfig, 'apiKey'>,\n): GeminiTTSAdapter<TModel> {\n  const apiKey = getGeminiApiKeyFromEnv()\n  return createGeminiSpeech(model, apiKey, config)\n}\n"],"names":[],"mappings":";;AA+EO,MAAM,yBAEH,eAAiD;AAAA,EAKzD,YAAY,QAAyB,OAAe;AAClD,UAAM,QAAQ,KAAK;AALrB,SAAS,OAAO;AAMd,SAAK,SAAS,mBAAmB,MAAM;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,eACJ,SACoB;AACpB,UAAM,EAAE,OAAO,MAAM,aAAA,IAAiB;AAEtC,UAAM,cAAc,cAAc,eAAe;AAAA,MAC/C,qBAAqB;AAAA,QACnB,WAAW;AAAA,MAAA;AAAA,IACb;AAGF,UAAM,WAAW,MAAM,KAAK,OAAO,OAAO,gBAAgB;AAAA,MACxD;AAAA,MACA,UAAU;AAAA,QACR;AAAA,UACE,MAAM;AAAA,UACN,OAAO,CAAC,EAAE,KAAA,CAAM;AAAA,QAAA;AAAA,MAClB;AAAA,MAEF,QAAQ;AAAA,QACN,oBAAoB,CAAC,OAAO;AAAA,QAC5B,cAAc;AAAA,UACZ;AAAA,UACA,GAAI,cAAc,gBAAgB;AAAA,YAChC,cAAc,aAAa;AAAA,UAAA;AAAA,QAC7B;AAAA,MACF;AAAA,MAEF,GAAI,cAAc,qBAAqB;AAAA,QACrC,mBAAmB,aAAa;AAAA,MAAA;AAAA,IAClC,CACD;AAGD,UAAM,YAAY,SAAS,aAAa,CAAC;AACzC,UAAM,QAAQ,WAAW,SAAS;AAElC,QAAI,CAAC,SAAS,MAAM,WAAW,GAAG;AAChC,YAAM,IAAI,MAAM,0CAA0C;AAAA,IAC5D;AAGA,UAAM,YAAY,MAAM;AAAA,MAAK,CAAC,SAC5B,KAAK,YAAY,UAAU,WAAW,QAAQ;AAAA,IAAA;AAGhD,QAAI,CAAC,aAAa,CAAC,UAAU,cAAc,CAAC,UAAU,WAAW,MAAM;AACrE,YAAM,IAAI,MAAM,sCAAsC;AAAA,IACxD;AAEA,UAAM,cAAc,UAAU,WAAW;AACzC,UAAM,WAAW,UAAU,WAAW,YAAY;AAClD,UAAM,SAAS,SAAS,MAAM,GAAG,EAAE,CAAC,KAAK;AAEzC,WAAO;AAAA,MACL,IAAI,WAAW,KAAK,IAAI;AAAA,MACxB;AAAA,MACA,OAAO;AAAA,MACP;AAAA,MACA,aAAa;AAAA,IAAA;AAAA,EAEjB;AACF;AAuBO,SAAS,mBACd,OACA,QACA,QAC0B;AAC1B,SAAO,IAAI,iBAAiB,EAAE,QAAQ,GAAG,OAAA,GAAU,KAAK;AAC1D;AA4BO,SAAS,aACd,OACA,QAC0B;AAC1B,QAAM,SAAS,uBAAA;AACf,SAAO,mBAAmB,OAAO,QAAQ,MAAM;AACjD;"}