{"version":3,"file":"image-provider-options.js","sources":["../../../src/image/image-provider-options.ts"],"sourcesContent":["import type { GeminiImageModels } from '../model-meta'\nimport type {\n  ImagePromptLanguage,\n  PersonGeneration,\n  SafetyFilterLevel,\n} from '@google/genai'\n\n// Re-export SDK types so users can use them directly\nexport type { ImagePromptLanguage, PersonGeneration, SafetyFilterLevel }\n\n/**\n * Gemini Imagen aspect ratio options\n * Controls the aspect ratio of generated images\n */\nexport type GeminiAspectRatio =\n  | '1:1'\n  | '3:4'\n  | '4:3'\n  | '9:16'\n  | '16:9'\n  | '9:21'\n  | '21:9'\n\n/**\n * Provider options for Gemini image generation\n * These options match the @google/genai GenerateImagesConfig interface\n * and can be spread directly into the API request.\n */\nexport interface GeminiImageProviderOptions {\n  /**\n   * The aspect ratio of generated images\n   * @default '1:1'\n   */\n  aspectRatio?: GeminiAspectRatio\n\n  /**\n   * Controls whether people can appear in generated images\n   * Use PersonGeneration enum values: DONT_ALLOW, ALLOW_ADULT, ALLOW_ALL\n   * @default 'ALLOW_ADULT'\n   */\n  personGeneration?: PersonGeneration\n\n  /**\n   * Safety filter level for content filtering\n   * Use SafetyFilterLevel enum values\n   */\n  safetyFilterLevel?: SafetyFilterLevel\n\n  /**\n   * Optional seed for reproducible image generation\n   * When the same seed is used with the same prompt and settings,\n   * you should get similar (though not identical) results\n   */\n  seed?: number\n\n  /**\n   * Whether to add a SynthID watermark to generated images\n   * SynthID helps identify AI-generated content\n   * @default true\n   */\n  addWatermark?: boolean\n\n  /**\n   * Language of the prompt\n   * Use ImagePromptLanguage enum values\n   */\n  language?: ImagePromptLanguage\n\n  /**\n   * Negative prompt - what to avoid in the generated image\n   * Not all models support negative prompts\n   */\n  negativePrompt?: string\n\n  /**\n   * Output MIME type for the generated image\n   * @default 'image/png'\n   */\n  outputMimeType?: 'image/png' | 'image/jpeg' | 'image/webp'\n\n  /**\n   * Compression quality for JPEG outputs (0-100)\n   * Higher values mean better quality but larger file sizes\n   * @default 75\n   */\n  outputCompressionQuality?: number\n\n  /**\n   * Controls how much the model adheres to the text prompt\n   * Large values increase output and prompt alignment,\n   * but may compromise image quality\n   */\n  guidanceScale?: number\n\n  /**\n   * Whether to use the prompt rewriting logic\n   */\n  enhancePrompt?: boolean\n\n  /**\n   * Whether to report the safety scores of each generated image\n   * and the positive prompt in the response\n   */\n  includeSafetyAttributes?: boolean\n\n  /**\n   * Whether to include the Responsible AI filter reason\n   * if the image is filtered out of the response\n   */\n  includeRaiReason?: boolean\n\n  /**\n   * Cloud Storage URI used to store the generated images\n   */\n  outputGcsUri?: string\n\n  /**\n   * User specified labels to track billing usage\n   */\n  labels?: Record<string, string>\n}\n\n/**\n * Model-specific provider options mapping\n * Currently all Imagen models use the same options structure\n */\nexport type GeminiImageModelProviderOptionsByName = {\n  [K in GeminiImageModels]: GeminiImageProviderOptions\n}\n\n/**\n * Supported size strings for Gemini Imagen models\n * These map to aspect ratios internally\n */\nexport type GeminiImageSize =\n  | '1024x1024'\n  | '512x512'\n  | '1024x768'\n  | '1536x1024'\n  | '1792x1024'\n  | '1920x1080'\n  | '768x1024'\n  | '1024x1536'\n  | '1024x1792'\n  | '1080x1920'\n\n/**\n * Model-specific size options mapping\n * All Imagen models use the same size options\n */\nexport type GeminiImageModelSizeByName = {\n  [K in GeminiImageModels]: GeminiImageSize\n}\n\n/**\n * Valid sizes for Gemini Imagen models\n * Gemini uses aspect ratios, but we map common WIDTHxHEIGHT formats to aspect ratios\n * These are approximate mappings based on common image dimensions\n */\nexport const GEMINI_SIZE_TO_ASPECT_RATIO: Record<string, GeminiAspectRatio> = {\n  // Square\n  '1024x1024': '1:1',\n  '512x512': '1:1',\n  // Landscape\n  '1024x768': '4:3',\n  '1536x1024': '4:3',\n  '1792x1024': '16:9',\n  '1920x1080': '16:9',\n  // Portrait\n  '768x1024': '3:4',\n  '1024x1536': '3:4', // Inverted\n  '1024x1792': '9:16',\n  '1080x1920': '9:16',\n}\n\n/**\n * Maps a WIDTHxHEIGHT size string to a Gemini aspect ratio\n * Returns undefined if the size cannot be mapped\n */\nexport function sizeToAspectRatio(\n  size: string | undefined,\n): GeminiAspectRatio | undefined {\n  if (!size) return undefined\n  return GEMINI_SIZE_TO_ASPECT_RATIO[size]\n}\n\n/**\n * Validates that the provided size can be mapped to an aspect ratio\n * Throws an error if the size is invalid\n */\nexport function validateImageSize(\n  model: string,\n  size: string | undefined,\n): void {\n  if (!size) return\n\n  const aspectRatio = sizeToAspectRatio(size)\n  if (!aspectRatio) {\n    const validSizes = Object.keys(GEMINI_SIZE_TO_ASPECT_RATIO)\n    throw new Error(\n      `Invalid size \"${size}\" for model \"${model}\". ` +\n        `Gemini Imagen uses aspect ratios. Valid sizes that map to aspect ratios: ${validSizes.join(', ')}. ` +\n        `Alternatively, use providerOptions.aspectRatio directly with values: 1:1, 3:4, 4:3, 9:16, 16:9, 9:21, 21:9`,\n    )\n  }\n}\n\n/**\n * Validates the number of images requested\n * Imagen models support 1-8 images per request (varies by model)\n */\nexport function validateNumberOfImages(\n  model: string,\n  numberOfImages: number | undefined,\n): void {\n  if (numberOfImages === undefined) return\n\n  // Most Imagen models support 1-4 images, some support up to 8\n  const maxImages = 4\n  if (numberOfImages < 1 || numberOfImages > maxImages) {\n    throw new Error(\n      `Invalid numberOfImages \"${numberOfImages}\" for model \"${model}\". ` +\n        `Must be between 1 and ${maxImages}.`,\n    )\n  }\n}\n\n/**\n * Validates the prompt is not empty\n */\nexport function validatePrompt(options: {\n  prompt: string\n  model: string\n}): void {\n  const { prompt, model } = options\n  if (!prompt || prompt.trim().length === 0) {\n    throw new Error(`Prompt cannot be empty for model \"${model}\".`)\n  }\n}\n"],"names":[],"mappings":"AA+JO,MAAM,8BAAiE;AAAA;AAAA,EAE5E,aAAa;AAAA,EACb,WAAW;AAAA;AAAA,EAEX,YAAY;AAAA,EACZ,aAAa;AAAA,EACb,aAAa;AAAA,EACb,aAAa;AAAA;AAAA,EAEb,YAAY;AAAA,EACZ,aAAa;AAAA;AAAA,EACb,aAAa;AAAA,EACb,aAAa;AACf;AAMO,SAAS,kBACd,MAC+B;AAC/B,MAAI,CAAC,KAAM,QAAO;AAClB,SAAO,4BAA4B,IAAI;AACzC;AAMO,SAAS,kBACd,OACA,MACM;AACN,MAAI,CAAC,KAAM;AAEX,QAAM,cAAc,kBAAkB,IAAI;AAC1C,MAAI,CAAC,aAAa;AAChB,UAAM,aAAa,OAAO,KAAK,2BAA2B;AAC1D,UAAM,IAAI;AAAA,MACR,iBAAiB,IAAI,gBAAgB,KAAK,+EACoC,WAAW,KAAK,IAAI,CAAC;AAAA,IAAA;AAAA,EAGvG;AACF;AAMO,SAAS,uBACd,OACA,gBACM;AACN,MAAI,mBAAmB,OAAW;AAGlC,QAAM,YAAY;AAClB,MAAI,iBAAiB,KAAK,iBAAiB,WAAW;AACpD,UAAM,IAAI;AAAA,MACR,2BAA2B,cAAc,gBAAgB,KAAK,4BACnC,SAAS;AAAA,IAAA;AAAA,EAExC;AACF;AAKO,SAAS,eAAe,SAGtB;AACP,QAAM,EAAE,QAAQ,MAAA,IAAU;AAC1B,MAAI,CAAC,UAAU,OAAO,KAAA,EAAO,WAAW,GAAG;AACzC,UAAM,IAAI,MAAM,qCAAqC,KAAK,IAAI;AAAA,EAChE;AACF;"}